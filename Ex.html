
<!doctype html>
<html lang="my">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rome</title>
<style>
body {
  margin: 0;
  padding: 28px;
  font-family: 'Orbitron', sans-serif;
  background: radial-gradient(circle at top left, #1c1c2e, #0b0b1a);
  color: #f0f8ff;
}
.container { max-width: 1100px; margin: 0 auto; }
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.header h1 { font-size: 28px; color: #b9f2ff; text-shadow: 0 0 6px #b9f2ff,0 0 12px #ffffff; }
.total { font-size: 24px; font-weight: bold; color: #ffd700; text-shadow: 0 0 6px #ffd700,0 0 12px #fff; }
.card, .bulk-input-card, .remaining-card, .winning-card {
  background: rgba(255,255,255,0.05);
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 8px 32px rgba(0,0,0,0.2);
  backdrop-filter: blur(8px);
}
label { display:block; font-size:12px; color:#c0c0c0; margin-bottom:6px; }
textarea,input,select { width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.03); color:#f0f8ff; font-size:14px; box-sizing:border-box; outline:none; }
button { background: linear-gradient(135deg,#b9f2ff,#ffd700); border:none; padding:10px 16px; border-radius:12px; color:#0b0b1a; font-weight:bold; font-size:14px; cursor:pointer; text-shadow:0 0 2px #fff; transition: all 0.2s ease; }
button:hover { transform:scale(1.05); box-shadow:0 0 12px #b9f2ff,0 0 24px #ffd700; }
button.ghost { background:transparent; border:1px solid rgba(255,255,255,0.2); color:#c0c0c0; }
button.small { padding:6px 12px; font-size:13px; }
.ledger-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 12px; margin-bottom: 20px; max-height: 400px; overflow-y: auto; padding: 8px; border-radius: 12px; background: rgba(255,255,255,0.03); }
.grid-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 12px 8px; text-align: center; border:1px solid rgba(255,255,255,0.2); box-shadow:0 0 8px rgba(255,255,255,0.1); transition: transform 0.3s, box-shadow 0.3s; cursor: pointer;}
.grid-item:hover { transform: scale(1.05); box-shadow: 0 0 12px #b9f2ff, 0 0 24px #ffd700; }
.grid-number { font-size:18px; font-weight:bold; margin-bottom:4px; color:#b9f2ff; text-shadow:0 0 6px #ffffff; }
.grid-amount { font-size:14px; color:#ffd700; }
.bulk-input-card, .winning-card { display: none; }
.remaining-box { white-space: pre-wrap; max-height:200px; overflow:auto; padding:12px; border-radius:12px; background:rgba(255,255,255,0.03); font-family:monospace; font-size:13px; line-height:1.4; margin-top:10px; border:1px solid rgba(255,255,255,0.2); color:#f0f8ff; }
.stats { margin-top:10px; font-size:13px; color:#c0c0c0; }
.stats strong { color:#ffd700; }
.method-note { 
  background: rgba(255,215,0,0.1); 
  border-left: 3px solid #ffd700; 
  padding: 10px; 
  margin: 10px 0; 
  border-radius: 8px;
  font-size: 13px;
}
.winning-item {
  margin-bottom: 4px;
  padding: 4px 8px;
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.05);
}
.win-amount {
  color: #ffd700;
  font-weight: bold;
}
.no-winner {
  color: #ff6b6b;
}
#congrats-message {
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
.heart {
  animation: heartbeat 1s infinite;
  display: inline-block;
  font-size: 28px;
}
@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3); }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Rome</h1>
    <div class="total">Total <span id="total-amount">0</span></div>
  </div>
  
  <!-- Bulk input box hidden initially -->
  <div id="bulk-card" class="card bulk-input-card">
    <label>Bulk Input (input)</label>
    
    <textarea id="bulk-input" rows="6" placeholder="please input right format"></textarea>
    <div style="margin-top:10px; display:flex; gap:8px;">
      <button id="btn-clear-input" class="ghost">Clear Input</button>
    </div>
  </div>
  
  <div class="card">
    <div id="ledger-grid" class="ledger-grid"></div>
    <div style="display:flex; gap:8px; align-items:center;">
      <button id="btn-copy" class="small">Copy Ledger</button>
      <button id="btn-clear" class="small ghost">Clear All</button>
      <button id="btn-toggle-bulk" class="small">Add Ledger</button>
      <button id="btn-toggle-winning" class="small">Check Winning</button>
    </div>
    <div class="stats">
      Entries: <span id="stat-count">0</span> â€” Total Amount: <strong id="stat-sum">0</strong>
    </div>
  </div>
  
  <div class="card remaining-card">
    <label id="remaining-label">Remaining (000â€“999 not in ledger)</label>
    <div style="display:flex; gap:8px; margin-bottom:10px;">
      <button id="btn-show-remaining" class="small">Show Remaining</button>
      <button id="btn-copy-remaining" class="small ghost">Copy Remaining</button>
    </div>
    <div id="remaining-box" class="remaining-box">(press "Show Remaining")</div>
  </div>
  
  <!-- Winning Check Card -->
  <div class="card winning-card">
    <label>Winning Check</label>
    
    <label>Winning Numbers</label>
    <textarea id="winning-input" rows="3" placeholder="Are you ready to win!"></textarea>
    
    <div style="display: flex; gap: 12px; margin-top: 12px; align-items: center;">
      <div style="flex: 1;">
        <label>Multiplier</label>
        <select id="winning-multiplier-select" style="width: 100%;">
          <option value="500">500x</option>
          <option value="800" selected>800x</option>
          <option value="custom">Custom x</option>
        </select>
      </div>
      <div style="flex: 1; display: none;" id="custom-multiplier-container">
        <label>Custom Multiplier</label>
        <input type="number" id="custom-multiplier" min="1" value="1000" style="width: 100%;">
      </div>
    </div>
    
    <div style="margin-top: 12px; display: flex; gap: 8px;">
      <button id="btn-check-winning" class="small">Check Winning</button>
      <button id="btn-clear-winning" class="small ghost">Clear</button>
      <button id="btn-close-winning" class="small ghost">Close</button>
    </div>
    
    <div id="winning-result" style="display: none; margin-top: 16px;">
      <div id="congrats-message" style="font-size: 24px; color: #ffd700; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; gap: 10px;">
        <!-- Animated heart will be inserted here -->
      </div>
      <div style="font-size: 18px; color: #b9f2ff; margin-bottom: 8px; text-align: center;">
        Total Win: <span id="total-win-amount" style="color: #ffd700;">0</span>
      </div>
      <div id="winning-breakdown" class="remaining-box" style="max-height: 200px; text-align: left; font-size: 14px; font-family: monospace;"></div>
    </div>
  </div>
  
  <footer style="margin-top:24px; text-align:center; color:#c0c0c0; font-size:13px;">
    design by rome
  </footer>
</div>

<script>
(() => {
  const pad3 = n => (''+n).padStart(3,'0');
  let ledger = new Map();
  let isRemainingShown = false;

  const ledgerGrid = document.getElementById('ledger-grid');
  const statCount = document.getElementById('stat-count');
  const statSum = document.getElementById('stat-sum');
  const totalAmount = document.getElementById('total-amount');
  const remainingBox = document.getElementById('remaining-box');
  const remainingLabel = document.getElementById('remaining-label');
  const bulkCard = document.getElementById('bulk-card');
  const bulkToggleBtn = document.getElementById('btn-toggle-bulk');
  
  // Winning Check Elements
  const winningCard = document.querySelector('.winning-card');
  const winningToggleBtn = document.getElementById('btn-toggle-winning');
  const winningInput = document.getElementById('winning-input');
  const winningMultiplierSelect = document.getElementById('winning-multiplier-select');
  const customMultiplierContainer = document.getElementById('custom-multiplier-container');
  const customMultiplierInput = document.getElementById('custom-multiplier');
  const winningResult = document.getElementById('winning-result');
  const totalWinAmount = document.getElementById('total-win-amount');
  const winningBreakdown = document.getElementById('winning-breakdown');
  const congratsMessage = document.getElementById('congrats-message');

  // Load ledger from localStorage
  const saved = localStorage.getItem('romeLedger');
  if(saved){
    const obj = JSON.parse(saved);
    ledger = new Map(Object.entries(obj).map(([k,v])=>[parseInt(k),v]));
  }

  function saveLedger(){ localStorage.setItem('romeLedger', JSON.stringify(Object.fromEntries(ledger))); }

  function updateLedger(){
    ledgerGrid.innerHTML = '';
    let total = 0;
    // Sort by bet amount descending (largest first)
    const sorted = [...ledger].sort((a,b)=>b[1] - a[1]);
    for(const [num, amt] of sorted){
      total += amt;
      const div = document.createElement('div');
      div.className='grid-item';
      div.innerHTML=`<div class="grid-number">${pad3(num)}</div><div class="grid-amount">${amt}</div>`;
      ledgerGrid.appendChild(div);
    }
    statCount.textContent = ledger.size;
    statSum.textContent = total;
    totalAmount.textContent = total;
    saveLedger();
  }

  function permute3(numStr){
    const arr=numStr.split(''); const set=new Set();
    const f=(a,l,r)=>{if(l===r){set.add(a.join('')); return;} for(let i=l;i<=r;i++){[a[l],a[i]]=[a[i],a[l]]; f(a,l+1,r); [a[l],a[i]]=[a[i],a[l]];}};
    f(arr,0,arr.length-1);
    return [...set].map(s=>parseInt(s,10));
  }

  function computeRemaining(){
    const rem=[]; for(let i=0;i<1000;i++){ if(!ledger.has(i)) rem.push(pad3(i)); }
    return rem;
  }

  // Helper function to split numbers by multiple separators
  function splitNumbers(input) {
    return input.split(/[.,\/\s]+/).map(n => n.trim()).filter(n => /^\d{1,3}$/.test(n));
  }

  // NEW: Process range notation
  function processRange(line) {
    // Pattern for range: 640 to 649 =500 or 640 to 649 r500
    const rangeMatch = line.match(/^(\d{3})\s+to\s+(\d{3})\s*([=r])(\d+)$/i);
    if (!rangeMatch) return null;
    
    const start = parseInt(rangeMatch[1]);
    const end = parseInt(rangeMatch[2]);
    const method = rangeMatch[3].toLowerCase();
    const amount = parseInt(rangeMatch[4]);
    
    if (start > end || start < 0 || end > 999) return null;
    
    return {
      start,
      end,
      method,
      amount,
      type: 'range'
    };
  }

  // Toggle Bulk Input
  bulkToggleBtn.addEventListener('click', ()=>{
    if(bulkCard.style.display==='none' || bulkCard.style.display===''){
      bulkCard.style.display='block';
      bulkToggleBtn.textContent='Hide Input';
    } else {
      bulkCard.style.display='none';
      bulkToggleBtn.textContent='Add Ledger';
    }
  });

  // Toggle Winning Card
  winningToggleBtn.addEventListener('click', ()=>{
    if(winningCard.style.display==='none' || winningCard.style.display===''){
      winningCard.style.display='block';
      winningToggleBtn.textContent='Hide Winning Check';
    } else {
      winningCard.style.display='none';
      winningToggleBtn.textContent='Check Winning';
      winningResult.style.display='none';
    }
  });

  // Toggle custom multiplier input
  winningMultiplierSelect.addEventListener('change', function() {
    if (this.value === 'custom') {
      customMultiplierContainer.style.display = 'block';
    } else {
      customMultiplierContainer.style.display = 'none';
    }
  });

  // Close Winning Card
  document.getElementById('btn-close-winning').addEventListener('click', () => {
    winningCard.style.display = 'none';
    winningToggleBtn.textContent = 'Check Winning';
    winningResult.style.display = 'none';
  });

  // Clear Input
  document.getElementById('btn-clear-input').addEventListener('click', ()=>{
    if(!confirm('Clear input textarea?')) return;
    document.getElementById('bulk-input').value = '';
  });

  // Clear Winning Input
  document.getElementById('btn-clear-winning').addEventListener('click', () => {
    winningInput.value = '';
    winningMultiplierSelect.value = '800';
    customMultiplierContainer.style.display = 'none';
    customMultiplierInput.value = '1000';
    winningResult.style.display = 'none';
  });

  // Copy Ledger
  document.getElementById('btn-copy').addEventListener('click', async ()=>{
    if(ledger.size===0){alert('Ledger empty'); return;}
    const lines=[...ledger].map(([n,a])=>pad3(n)+' '+a).join('\n');
    await navigator.clipboard.writeText(lines); alert('Copied ledger');
  });

  // Clear Ledger
  document.getElementById('btn-clear').addEventListener('click', ()=>{
    if(!confirm('Clear all ledger and reset app?')) return;
    ledger.clear();
    localStorage.removeItem('romeLedger');
    remainingBox.textContent='(press "Show Remaining")';
    remainingLabel.textContent='Remaining (000â€“999 not in ledger)';
    document.getElementById('btn-show-remaining').textContent = 'Show Remaining';
    isRemainingShown = false;
    updateLedger();
  });

  // Show/Hide Remaining - MODIFIED: 10 columns to 6 columns
  document.getElementById('btn-show-remaining').addEventListener('click', ()=>{
    const btn = document.getElementById('btn-show-remaining');
    const remainingBox = document.getElementById('remaining-box');
    const remainingLabel = document.getElementById('remaining-label');
    
    if (!isRemainingShown) {
      // Show remaining
      const rem = computeRemaining();
      remainingLabel.textContent = `Remaining (${rem.length} numbers)`;
      let out=[];
      // CHANGE: From 10 columns to 6 columns
      for(let i=0;i<rem.length;i+=6) out.push(rem.slice(i,i+6).join('  '));
      remainingBox.textContent=out.join('\n');
      btn.textContent = 'Hide Remaining';
      isRemainingShown = true;
    } else {
      // Hide remaining
      remainingBox.textContent = '(press "Show Remaining")';
      remainingLabel.textContent = 'Remaining (000â€“999 not in ledger)';
      btn.textContent = 'Show Remaining';
      isRemainingShown = false;
    }
  });

  // Copy Remaining
  document.getElementById('btn-copy-remaining').addEventListener('click', async ()=>{
    const text = remainingBox.textContent.trim();
    if(!text||text==='(press "Show Remaining")'){alert('No remaining'); return;}
    await navigator.clipboard.writeText(text); alert('Remaining copied');
  });

  // Handle Bulk Add Ledger - MODIFIED: Support different bet amounts for different lines
  const bulkAddBtn = document.createElement('button');
  bulkAddBtn.textContent='Submit Ledger';
  bulkAddBtn.className='small';
  bulkAddBtn.style.marginTop='10px';
  bulkCard.appendChild(bulkAddBtn);

  bulkAddBtn.addEventListener('click', ()=>{
    const text = document.getElementById('bulk-input').value;
    if(!text.trim()){alert('No input'); return;}
    
    const lines = text.split('\n').map(l=>l.trim()).filter(l=>l);
    
    // Process each line individually with its own method
    lines.forEach(line => {
      // Check if this line is a range
      const rangeInfo = processRange(line);
      if (rangeInfo) {
        // Process range
        for (let num = rangeInfo.start; num <= rangeInfo.end; num++) {
          if (rangeInfo.method === 'r') {
            const perms = permute3(pad3(num));
            perms.forEach(permNum => {
              ledger.has(permNum) ? ledger.set(permNum, ledger.get(permNum) + rangeInfo.amount) : ledger.set(permNum, rangeInfo.amount);
            });
          } else {
            ledger.has(num) ? ledger.set(num, ledger.get(num) + rangeInfo.amount) : ledger.set(num, rangeInfo.amount);
          }
        }
      } else {
        // Extract method and amount from the end of line
        let amt = 10;
        let isR = false;
        
        // Check for R method (=R20 or =r20 or R20 or r20)
        const matchR = line.match(/[=\s]?[rR](\d+)$/i);
        // Check for = method (=20)
        const matchEq = line.match(/[=\s](\d+)$/);
        
        let numsPart = line;
        
        if (matchR) {
          // Handle R method
          amt = parseInt(matchR[1], 10);
          // Remove the method part from the line
          const methodLength = matchR[0].length;
          numsPart = line.substring(0, line.length - methodLength).trim();
          isR = true;
        } else if (matchEq) {
          // Handle = method
          amt = parseInt(matchEq[1], 10);
          // Remove the method part from the line
          const methodLength = matchEq[0].length;
          numsPart = line.substring(0, line.length - methodLength).trim();
        }
        
        // Parse numbers
        const nums = splitNumbers(numsPart);
        
        // Add numbers to ledger
        nums.forEach(n => {
          if (isR) {
            // R method: permute all 3-digit numbers
            const numsToAdd = permute3(n);
            numsToAdd.forEach(nn => {
              ledger.has(nn) ? ledger.set(nn, ledger.get(nn) + amt) : ledger.set(nn, amt);
            });
          } else {
            // = method: add the number as-is
            const nn = parseInt(n, 10);
            if (nn >= 0 && nn <= 999) {
              ledger.has(nn) ? ledger.set(nn, ledger.get(nn) + amt) : ledger.set(nn, amt);
            }
          }
        });
      }
    });
    
    updateLedger();
    alert('Added to ledger');
    bulkCard.style.display='none';
    bulkToggleBtn.textContent='Add Ledger';
    document.getElementById('bulk-input').value='';
    
    // Reset remaining display if it was shown
    if (isRemainingShown) {
      document.getElementById('remaining-box').textContent = '(press "Show Remaining")';
      document.getElementById('remaining-label').textContent = 'Remaining (000â€“999 not in ledger)';
      document.getElementById('btn-show-remaining').textContent = 'Show Remaining';
      isRemainingShown = false;
    }
  });

  // Check Winning Function
  document.getElementById('btn-check-winning').addEventListener('click', () => {
    const numbersText = winningInput.value.trim();
    if (!numbersText) {
      alert('Please enter winning numbers');
      return;
    }

    // Parse numbers (allow spaces, commas, newlines)
    const numbers = numbersText.split(/[,\s]+/)
      .map(n => n.trim())
      .filter(n => /^\d{1,3}$/.test(n))
      .map(n => parseInt(n, 10))
      .filter(n => n >= 0 && n <= 999);
    
    if (numbers.length === 0) {
      alert('No valid numbers found (000-999 only)');
      return;
    }

    // Get multiplier
    let multiplier;
    if (winningMultiplierSelect.value === 'custom') {
      multiplier = parseInt(customMultiplierInput.value) || 1;
    } else {
      multiplier = parseInt(winningMultiplierSelect.value);
    }
    
    if (multiplier <= 0) {
      alert('Multiplier must be greater than 0');
      return;
    }

    let totalWin = 0;
    let breakdown = [];
    let hasWinner = false;
    
    // Check each number against ledger
    numbers.forEach(num => {
      const ledgerAmount = ledger.get(num) || 0;
      if (ledgerAmount > 0) {
        const winForThisNumber = ledgerAmount * multiplier;
        totalWin += winForThisNumber;
        breakdown.push(`<div class="winning-item">${pad3(num)}: ${ledgerAmount} Ã— ${multiplier} = <span class="win-amount">${winForThisNumber}</span></div>`);
        hasWinner = true;
      } else {
        breakdown.push(`<div class="winning-item no-winner">${pad3(num)}: No bet (0)</div>`);
      }
    });
    
    // Display results
    totalWinAmount.textContent = totalWin.toLocaleString();
    winningBreakdown.innerHTML = breakdown.join('');
    
    // Show congratulations if there's any win
    if (hasWinner) {
      congratsMessage.innerHTML = `<span class="heart">ðŸ™ˆ</span> Congratulations! <span class="heart">ðŸ™ˆ</span>`;
      winningResult.style.display = 'block';
    } else {
      congratsMessage.innerHTML = `<span style="color: #ff6b6b;">No winning numbers found in ledger</span>`;
      winningResult.style.display = 'block';
    }
  });

  updateLedger();
})();
</script>
</body>
</html>
