<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rome 3D Lottery Ledger V8.4</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* CSS ·ÄÄ·ÄØ·Äí·Ä∫·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äô·Äæ·Ä¨·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫ */
:root {
  /* Dark Theme (Default) */
  --bg-primary: radial-gradient(circle at top left, #1c1c2e, #0b0b1a);
  --text-primary: #f0f8ff;
  --card-bg: rgba(255,255,255,0.05);
  --card-border: rgba(255,255,255,0.2);
  --accent-color: #b9f2ff;
  --gold-color: #ffd700;
  --subtle-color: #a0a0c0;
  --danger-color: #ff6b6b;
  --success-color: #4caf50;
  --shadow-color: rgba(0,0,0,0.2);
  --hover-bg: rgba(255,255,255,0.1);
}

body {
  margin: 0;
  padding: 15px;
  font-family: 'Segoe UI', system-ui, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  transition: all 0.3s ease;
}
.container { max-width: 1000px; margin: 0 auto; }
.header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 15px;
  background: var(--card-bg);
  padding: 12px 15px;
  border-radius: 12px;
  border: 1px solid var(--card-border);
}
.header h1 { 
  font-size: 20px; 
  color: var(--accent-color); 
  text-shadow: 0 0 4px var(--accent-color);
  margin: 0;
}
.total { 
  font-size: 18px; 
  font-weight: bold; 
  color: var(--gold-color); 
  text-shadow: 0 0 4px var(--gold-color);
}
.subtitle {
  font-size: 11px;
  color: var(--subtle-color);
  margin-top: 3px;
}
.card {
  background: var(--card-bg);
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 12px;
  border: 1px solid var(--card-border);
  box-shadow: 0 4px 16px var(--shadow-color);
}
.card-title {
  font-size: 14px;
  color: var(--accent-color);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}
label { 
  display: block; 
  font-size: 11px; 
  color: var(--subtle-color); 
  margin-bottom: 3px; 
  font-weight: 500;
}
textarea, input, select { 
  width: 100%; 
  padding: 8px 10px; 
  border-radius: 8px; 
  border: 1px solid var(--card-border); 
  background: rgba(255,255,255,0.1); 
  color: var(--text-primary); 
  font-size: 12px; 
  box-sizing: border-box; 
  outline: none; 
  transition: border 0.3s;
}
textarea:focus, input:focus, select:focus {
  border: 1px solid var(--accent-color);
}
button { 
  background: linear-gradient(135deg, var(--accent-color), var(--gold-color)); 
  border: none; 
  padding: 7px 12px; 
  border-radius: 8px; 
  color: #0b0b1a; 
  font-weight: bold; 
  font-size: 12px; 
  cursor: pointer; 
  transition: all 0.2s ease; 
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
button:hover { 
  transform: scale(1.02); 
  box-shadow: 0 0 6px var(--accent-color); 
}
button.ghost { 
  background: transparent; 
  border: 1px solid var(--card-border); 
  color: var(--subtle-color); 
}
button.ghost:hover {
  background: var(--hover-bg);
}
button.small { 
  padding: 5px 10px; 
  font-size: 11px; 
}
button.success {
  background: linear-gradient(135deg, var(--success-color), #81c784);
}
.ledger-grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fill, minmax(75px, 1fr)); 
  gap: 8px; 
  margin-bottom: 12px; 
  max-height: 250px; 
  overflow-y: auto; 
  padding: 5px; 
  border-radius: 8px; 
  background: rgba(255,255,255,0.05); 
}
.grid-item { 
  background: var(--card-bg); 
  border-radius: 8px; 
  padding: 8px 5px; 
  text-align: center; 
  border: 1px solid var(--card-border); 
  transition: transform 0.3s; 
  cursor: pointer;
  position: relative;
}
.grid-item:hover { 
  transform: scale(1.03); 
  box-shadow: 0 0 6px var(--accent-color); 
}
.grid-item.high-bet {
  border-color: var(--gold-color);
  background: rgba(255, 215, 0, 0.1);
}
.grid-number { 
  font-size: 14px; 
  font-weight: bold; 
  margin-bottom: 2px; 
  color: var(--accent-color); 
}
.grid-amount { 
  font-size: 11px; 
  color: var(--gold-color); 
}
.bulk-input-card, .winning-card, .settings-card, .history-card, .twod-card { 
  display: none; 
}
.remaining-box { 
  white-space: pre-wrap; 
  max-height: 120px; 
  overflow: auto; 
  padding: 8px; 
  border-radius: 8px; 
  background: rgba(255,255,255,0.05); 
  font-family: 'Courier New', monospace; 
  font-size: 11px; 
  line-height: 1.2; 
  margin-top: 6px; 
  border: 1px solid var(--card-border); 
}
.stats { 
  margin-top: 6px; 
  font-size: 11px; 
  color: var(--subtle-color); 
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.stats strong { 
  color: var(--gold-color); 
}
.stats-item {
  display: flex;
  align-items: center;
  gap: 3px;
}
.tabs {
  display: flex;
  gap: 3px;
  margin-bottom: 10px;
  border-bottom: 1px solid var(--card-border);
  padding-bottom: 6px;
  flex-wrap: wrap;
}
.tab {
  padding: 5px 10px;
  background: var(--card-bg);
  border-radius: 5px;
  cursor: pointer;
  color: var(--subtle-color);
  transition: all 0.2s;
  font-size: 12px;
  flex: 1;
  text-align: center;
  min-width: 80px;
}
.tab.active {
  background: rgba(185, 242, 255, 0.15);
  color: var(--accent-color);
}
.tab:hover:not(.active) {
  background: var(--hover-bg);
}
.action-buttons {
  display: flex;
  gap: 5px;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: 6px;
}
.footer {
  margin-top: 15px; 
  text-align: center; 
  color: var(--subtle-color); 
  font-size: 11px;
  padding-top: 10px;
  border-top: 1px solid var(--card-border);
}
.winning-item {
  margin-bottom: 3px;
  padding: 6px 8px;
  border-radius: 5px;
  background: var(--card-bg);
  display: flex;
  justify-content: space-between;
  font-size: 11px;
}
.win-amount {
  color: var(--gold-color);
  font-weight: bold;
}
.no-winner {
  color: var(--danger-color);
}
#winning-result {
  margin-top: 10px;
  border-top: 1px solid var(--card-border);
  padding-top: 8px;
}
#congrats-message {
  font-size: 14px;
  color: var(--gold-color);
  text-align: center;
  margin-bottom: 5px;
}
#total-win-amount {
  font-size: 16px;
  color: var(--gold-color);
  font-weight: bold;
}
.amount-inputs {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap: 6px;
  margin-top: 6px;
}
.amount-option {
  text-align: center;
  padding: 6px;
  background: var(--card-bg);
  border-radius: 5px;
  cursor: pointer;
  border: 1px solid var(--card-border);
  transition: all 0.2s;
  font-size: 11px;
}
.amount-option:hover {
  background: var(--hover-bg);
}
.amount-option.active {
  background: rgba(255,215,0,0.2);
  border-color: var(--gold-color);
}
.settings-option {
  margin-bottom: 12px;
}
.settings-option label {
  font-size: 12px;
  margin-bottom: 6px;
  display: block;
}
.settings-buttons {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}
.settings-btn {
  flex: 1;
  min-width: 120px;
  justify-content: center;
}
.lang-badge {
  font-size: 10px;
  background: var(--accent-color);
  color: white;
  padding: 1px 4px;
  border-radius: 3px;
  margin-left: 4px;
}
.history-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 8px;
  border-bottom: 1px solid var(--card-border);
  font-size: 11px;
}
.history-numbers {
  font-family: 'Courier New', monospace;
  font-weight: bold;
}
.history-amount {
  color: var(--gold-color);
}
.history-date {
  font-size: 9px;
  color: var(--subtle-color);
}
.bet-types {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 6px;
  margin-top: 8px;
}
.bet-type-btn {
  text-align: center;
  padding: 8px 4px;
  background: var(--card-bg);
  border-radius: 6px;
  cursor: pointer;
  border: 1px solid var(--card-border);
  transition: all 0.2s;
  font-size: 10px;
  line-height: 1.2;
}
.bet-type-btn:hover {
  background: var(--hover-bg);
}
.bet-type-btn.active {
  background: rgba(185, 242, 255, 0.2);
  border-color: var(--accent-color);
}
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--success-color);
  color: white;
  padding: 10px 15px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 1000;
  animation: slideIn 0.3s ease, fadeOut 0.3s ease 2s forwards;
  max-width: 300px;
}
@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}
.shortcut-hint {
  font-size: 9px;
  color: var(--subtle-color);
  margin-top: 2px;
  font-style: italic;
}
/* 2D Mode Styles */
.twod-content {
  text-align: center;
  padding: 20px 15px;
}
.twod-icon {
  font-size: 48px;
  color: var(--accent-color);
  margin-bottom: 15px;
  text-shadow: 0 0 8px var(--accent-color);
}
.twod-title {
  font-size: 18px;
  color: var(--accent-color);
  margin-bottom: 10px;
  font-weight: bold;
}
.twod-description {
  font-size: 13px;
  color: var(--subtle-color);
  margin-bottom: 20px;
  line-height: 1.5;
}
.twod-links {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 20px;
}
.twod-link {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 20px;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 8px;
  color: var(--text-primary);
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.3s ease;
}
.twod-link:hover {
  background: var(--hover-bg);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px var(--shadow-color);
  border-color: var(--accent-color);
}
.twod-link i {
  font-size: 18px;
}
.twod-link.primary {
  background: linear-gradient(135deg, var(--accent-color), var(--gold-color));
  color: #0b0b1a;
  border: none;
}
.twod-link.primary:hover {
  background: linear-gradient(135deg, var(--gold-color), var(--accent-color));
  box-shadow: 0 4px 12px rgba(185, 242, 255, 0.3);
}
.twod-version {
  font-size: 11px;
  color: var(--subtle-color);
  margin-top: 25px;
  padding-top: 10px;
  border-top: 1px solid var(--card-border);
}
</style>
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div>
      <h1><i class="fas fa-dice"></i>ROME LEDGER(RLG)</h1>
      <div class="subtitle">best ledger ever!</div>
    </div>
    <div class="total">Total: <span id="total-amount">0</span></div>
  </div>
  
  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" data-tab="ledger">Ledgers</div>
    <div class="tab" data-tab="add-bets">Add Ledger</div>
    <div class="tab" data-tab="winning">Check Winning</div>
    <div class="tab" data-tab="history">History</div>
    <div class="tab" data-tab="twod">Switch to 2D Mode</div>
  </div>
  
  <!-- Ledger Card -->
  <div class="card" id="ledger-card">
    <div class="card-title">
      <i class="fas fa-book"></i> Current Ledger
      <span class="shortcut-hint">(Click number to remove)</span>
    </div>
    <div id="ledger-grid" class="ledger-grid"></div>
    <div class="action-buttons">
      <button id="btn-copy" class="small"><i class="fas fa-copy"></i> Copy Ledger</button>
      <button id="btn-clear" class="small ghost"><i class="fas fa-trash"></i> Clear All</button>
    </div>
    <div class="stats">
      <div class="stats-item"><i class="fas fa-list-ol"></i> Entries: <strong id="stat-count">0</strong></div>
      <div class="stats-item"><i class="fas fa-coins"></i> Total Amount: <strong id="stat-sum">0</strong></div>
      <div class="stats-item"><i class="fas fa-chart-bar"></i> Coverage: <strong id="stat-coverage">0%</strong></div>
      <div class="stats-item"><i class="fas fa-star"></i> Max Bet: <strong id="stat-max">0</strong></div>
    </div>
  </div>
  
  <!-- Bulk Input Card -->
  <div class="card bulk-input-card" id="bulk-card">
    <div class="card-title">
      <i class="fas fa-keyboard"></i> Bulk Input
    </div>
    
    <textarea id="bulk-input" rows="6" placeholder="·ÄÅ·ÄΩ·Ä±·Åä·ÄÅ·ÄΩ·Ä±·Äï·Ä∞·Ä∏·ÄÅ·ÄΩtri·Åä·Äë·Ä≠·Äï·Ä∫·Åä·Äú·Äö·Ä∫·Åä·Äï·Ä≠·Äê·Ä∫·Åä·Ä°·Äï·Ä∞·Ä∏·Åä·ÄÅ·ÄΩ·Åä110 to 119R100(·Äí·Ä≤·Ä∑·ÄÜ·Ä≠·ÄØ=)
"></textarea>
    
    <div style="margin-top:10px; display:flex; gap:5px; flex-wrap: wrap;">
      <button id="btn-submit-bulk"><i class="fas fa-check"></i> Submit Bets</button>
      <button id="btn-clear-input" class="ghost"><i class="fas fa-eraser"></i> Clear</button>
      <button id="btn-preview" class="ghost"><i class="fas fa-eye"></i> Preview</button>
    </div>
  </div>
  
  <!-- Remaining Card -->
  <div class="card remaining-card">
    <div class="card-title">
      <i class="fas fa-list-alt"></i> Remaining Numbers
    </div>
    <div style="display:flex; gap:5px; margin-bottom:6px; flex-wrap: wrap;">
      <button id="btn-show-remaining" class="small"><i class="fas fa-eye"></i> Show</button>
      <button id="btn-copy-remaining" class="small ghost"><i class="fas fa-copy"></i> Copy</button>
      <button id="btn-add-remaining" class="small"><i class="fas fa-plus"></i> Add All</button>
    </div>
    <div id="remaining-box" class="remaining-box">(Click "Show" to view numbers not in ledger)</div>
    <div class="stats">
      <div class="stats-item"><i class="fas fa-hashtag"></i> Remaining: <strong id="remaining-count">1000</strong></div>
      <div class="stats-item"><i class="fas fa-check-circle"></i> Covered: <strong id="covered-count">0</strong></div>
    </div>
  </div>
  
  <!-- Winning Check Card -->
  <div class="card winning-card" id="winning-card">
    <div class="card-title">
      <i class="fas fa-trophy"></i> Winning Check
    </div>
    
    <label>Winning Numbers (separate by space or comma)</label>
    <textarea id="winning-input" rows="2" placeholder="Enter winning numbers (e.g., 123 456 789)"></textarea>
    
    <div style="margin-top: 8px;">
      <label>Multiplier</label>
      <select id="winning-multiplier-select" style="width: 100%;">
        <option value="550">550x (Standard)</option>
        <option value="800" selected>800x (Special)</option>
        <option value="900">900x (VIP)</option>
        <option value="1500">1500x (Premium)</option>
      </select>
    </div>
    
    <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: wrap;">
      <button id="btn-check-winning" class="small"><i class="fas fa-calculator"></i> Check Winning</button>
      <button id="btn-clear-winning" class="small ghost"><i class="fas fa-eraser"></i> Clear</button>
    </div>
    
    <div id="winning-result" style="display: none;">
      <div id="congrats-message"></div>
      <div style="font-size: 13px; color: var(--accent-color); margin-bottom: 5px; text-align: center;">
        Total Win: <span id="total-win-amount" style="color: var(--gold-color);">0</span>
      </div>
      <div id="winning-breakdown" style="max-height: 120px; overflow: auto; font-size: 11px;"></div>
    </div>
  </div>
  
  <!-- History Card -->
  <div class="card history-card" id="history-card">
    <div class="card-title">
      <i class="fas fa-history"></i> Betting History
    </div>
    <div class="action-buttons">
      <button id="btn-clear-history" class="small ghost"><i class="fas fa-trash"></i> Clear History</button>
    </div>
    <div id="history-list" style="max-height: 200px; overflow-y: auto;">
      <div style="text-align: center; padding: 20px; color: var(--subtle-color);">
        <i class="fas fa-clock" style="font-size: 24px; margin-bottom: 8px;"></i>
        <div>No history yet</div>
      </div>
    </div>
  </div>
  
  <!-- 2D Mode Card -->
  <div class="card twod-card" id="twod-card">
    <div class="twod-content">
      <div class="twod-icon">
        <i class="fas fa-exchange-alt"></i>
      </div>
      <div class="twod-title">Switch to 2D Mode</div>
      <div class="twod-description">
        Click the button below to switch to the 2D Lottery Ledger.<br>
        The 2D version is optimized for 2-digit lottery betting.
      </div>
      
      <div class="twod-links">
        <a href="history.html" class="twod-link primary">
          <i class="fas fa-external-link-alt"></i>
          Go to 2D Ledger
        </a>
        
        <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; font-size: 11px; color: var(--subtle-color);">
          <i class="fas fa-info-circle"></i> 
          Note: 2D ledger will open in a new page. Make sure to save your current 3D ledger first.
        </div>
      </div>
      
      <div class="twod-version">
        Rome Ledger V8.4<br>
        ¬© 2023 ROME. All rights reserved.
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="footer">
    <div>3D Lottery Ledger Design by ROME</div>
  </footer>
</div>

<!-- Notification Container -->
<div id="notification-container"></div>

<script>
// JavaScript ·ÄÄ·ÄØ·Äí·Ä∫·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äô·Äæ·Ä¨·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫
(() => {
  const pad3 = n => (''+n).padStart(3,'0');
  let ledger = new Map();
  let isRemainingShown = false;
  let currentAmount = 500;
  let history = [];
  
  // Theme management
  let currentTheme = localStorage.getItem('ledgerTheme') || 'dark';
  
  // DOM Elements
  const ledgerGrid = document.getElementById('ledger-grid');
  const statCount = document.getElementById('stat-count');
  const statSum = document.getElementById('stat-sum');
  const totalAmount = document.getElementById('total-amount');
  const statCoverage = document.getElementById('stat-coverage');
  const statMax = document.getElementById('stat-max');
  const remainingBox = document.getElementById('remaining-box');
  const remainingCount = document.getElementById('remaining-count');
  const coveredCount = document.getElementById('covered-count');
  const bulkCard = document.getElementById('bulk-card');
  const winningCard = document.getElementById('winning-card');
  const historyCard = document.getElementById('history-card');
  const ledgerCard = document.getElementById('ledger-card');
  const twodCard = document.getElementById('twod-card');
  const tabs = document.querySelectorAll('.tab');
  const winningInput = document.getElementById('winning-input');
  const winningMultiplierSelect = document.getElementById('winning-multiplier-select');
  const winningResult = document.getElementById('winning-result');
  const totalWinAmount = document.getElementById('total-win-amount');
  const winningBreakdown = document.getElementById('winning-breakdown');
  const congratsMessage = document.getElementById('congrats-message');
  
  // Add history entry
  function addHistoryEntry(type, details) {
    const entry = {
      type: type,
      details: details,
      timestamp: Date.now()
    };
    history.unshift(entry);
    if (history.length > 100) history = history.slice(0, 100);
    localStorage.setItem('ledgerHistory', JSON.stringify(history));
    updateHistoryDisplay();
  }
  
  // Load saved data
  function loadSavedData() {
    // Load ledger
    const savedLedger = localStorage.getItem('simpleLedger');
    if(savedLedger){
      try {
        const obj = JSON.parse(savedLedger);
        ledger = new Map(Object.entries(obj).map(([k,v]) => [parseInt(k), parseInt(v)]));
      } catch(e) {
        ledger = new Map();
      }
    }
    
    // Load history
    const savedHistory = localStorage.getItem('ledgerHistory');
    if(savedHistory){
      try {
        history = JSON.parse(savedHistory);
      } catch(e) {
        history = [];
      }
    }
    
    // Load settings
    const savedSettings = localStorage.getItem('ledgerSettings');
    if(savedSettings){
      try {
        const settings = JSON.parse(savedSettings);
        if(settings.defaultAmount) {
          currentAmount = settings.defaultAmount;
        }
      } catch(e) {}
    }
  }
  
  // Show notification
  function showNotification(message, type = 'success') {
    const container = document.getElementById('notification-container');
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.style.background = type === 'success' ? 'var(--success-color)' : 
                                   type === 'warning' ? 'var(--gold-color)' : 'var(--danger-color)';
    notification.textContent = message;
    container.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 2500);
  }
  
  // Save ledger
  function saveLedger(){ 
    localStorage.setItem('simpleLedger', JSON.stringify(Object.fromEntries(ledger)));
    localStorage.setItem('ledgerLastSave', Date.now().toString());
  }
  
  // Update ledger display
  function updateLedger(){
    ledgerGrid.innerHTML = '';
    let total = 0;
    let maxBet = 0;
    
    const sorted = [...ledger].sort((a,b) => b[1] - a[1]);
    
    // Calculate totals
    sorted.forEach(([num, amt]) => {
      total += amt;
      maxBet = Math.max(maxBet, amt);
    });
    
    for(const [num, amt] of sorted){
      const div = document.createElement('div');
      div.className = `grid-item ${amt >= 1000 ? 'high-bet' : ''}`;
      div.innerHTML = `
        <div class="grid-number">${pad3(num)}</div>
        <div class="grid-amount">${amt.toLocaleString()}</div>
      `;
      div.addEventListener('click', () => {
        if(confirm(`Remove ${pad3(num)} (${amt}) from ledger?`)) {
          addHistoryEntry('bet_removed', {
            number: pad3(num),
            amount: amt
          });
          ledger.delete(num);
          updateLedger();
          showNotification(`Removed ${pad3(num)}`, 'warning');
        }
      });
      ledgerGrid.appendChild(div);
    }
    
    const count = ledger.size;
    statCount.textContent = count;
    statSum.textContent = total.toLocaleString();
    totalAmount.textContent = total.toLocaleString();
    coveredCount.textContent = count;
    remainingCount.textContent = 1000 - count;
    statCoverage.textContent = `${(count / 10).toFixed(1)}%`;
    statMax.textContent = maxBet.toLocaleString();
    
    saveLedger();
    
    if (isRemainingShown) {
      showRemainingNumbers();
    }
  }
  
  // Update history display
  function updateHistoryDisplay() {
    const historyList = document.getElementById('history-list');
    if(history.length === 0) {
      historyList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: var(--subtle-color);">
          <i class="fas fa-clock" style="font-size: 24px; margin-bottom: 8px;"></i>
          <div>No history yet</div>
        </div>
      `;
      return;
    }
    
    historyList.innerHTML = '';
    history.forEach((entry, index) => {
      const item = document.createElement('div');
      item.className = 'history-item';
      const date = new Date(entry.timestamp);
      let content = '';
      switch(entry.type) {
        case 'ledger_update':
          content = `<div class="history-numbers">Ledger updated: ${entry.details.count} bets, total ${entry.details.total.toLocaleString()}</div>`;
          break;
        case 'bet_added':
          content = `<div class="history-numbers">Bets added: ${entry.details.count} numbers, total ${entry.details.total.toLocaleString()}</div>`;
          break;
        case 'bet_removed':
          content = `<div class="history-numbers">Bet removed: ${entry.details.number} (${entry.details.amount})</div>`;
          break;
        case 'ledger_cleared':
          content = `<div class="history-numbers">Ledger cleared</div>`;
          break;
        case 'winning_checked':
          content = `<div class="history-numbers">Winning checked: ${entry.details.winnerCount} winner(s), total win ${entry.details.totalWin.toLocaleString()}</div>`;
          break;
        case 'remaining_added':
          content = `<div class="history-numbers">Remaining added: ${entry.details.count} numbers, total ${entry.details.total.toLocaleString()}</div>`;
          break;
        case 'bulk_added':
          content = `<div class="history-numbers">Bulk added: ${entry.details.lineCount} lines, total ${entry.details.total.toLocaleString()}</div>`;
          break;
        default:
          content = `<div class="history-numbers">${JSON.stringify(entry.details)}</div>`;
      }
      item.innerHTML = `
        <div>
          ${content}
          <div class="history-date">${date.toLocaleDateString()} ${date.toLocaleTimeString()}</div>
        </div>
      `;
      historyList.appendChild(item);
    });
  }
  
  // Theme switching function
  function switchTheme(theme) {
    currentTheme = theme;
    localStorage.setItem('ledgerTheme', theme);
    
    if(theme === 'dark') {
      document.body.classList.remove('light-theme');
    }
  }
  
  // Permutation function
  function permute3(numStr){
    const arr = numStr.split('');
    const result = new Set();
    
    function permute(current, remaining) {
      if (current.length === 3) {
        result.add(current.join(''));
        return;
      }
      
      for (let i = 0; i < remaining.length; i++) {
        const next = [...current, remaining[i]];
        const newRemaining = [...remaining.slice(0, i), ...remaining.slice(i + 1)];
        permute(next, newRemaining);
      }
    }
    
    permute([], arr);
    return [...result].map(s => parseInt(s, 10));
  }
  
  // Compute remaining numbers
  function computeRemaining(){
    const rem = [];
    for(let i = 0; i < 1000; i++){ 
      if(!ledger.has(i)) rem.push(pad3(i)); 
    }
    return rem;
  }
  
  // Show remaining numbers
  function showRemainingNumbers(){
    const rem = computeRemaining();
    let out = [];
    for(let i = 0; i < rem.length; i += 6) {
      out.push(rem.slice(i, i+6).join('  '));
    }
    remainingBox.textContent = out.join('\n');
    isRemainingShown = true;
    document.getElementById('btn-show-remaining').innerHTML = '<i class="fas fa-eye-slash"></i> Hide';
  }
  
  // Split numbers function
  function splitNumbers(input) {
    return input.split(/[\s\/\*\.,-]+/)
      .map(n => n.trim())
      .filter(n => /^\d{1,3}$/.test(n))
      .map(n => parseInt(n, 10))
      .filter(n => n >= 0 && n <= 999);
  }
  
  // Process different bet types
  function processRange(line) {
    const rangeMatch = line.match(/^(\d{3})\s+to\s+(\d{3})\s*([=r])(\d+)$/i);
    if (!rangeMatch) return null;
    
    const start = parseInt(rangeMatch[1]);
    const end = parseInt(rangeMatch[2]);
    const method = rangeMatch[3].toLowerCase();
    const amount = parseInt(rangeMatch[4]);
    
    if (start > end || start < 0 || end > 999) return null;
    
    return { start, end, method, amount, type: 'range' };
  }
  
  function processKhwe(line) {
    const khweMatch = line.match(/^([0-9]*)·ÄÅ·ÄΩ·Ä±(\d+)$/);
    if (!khweMatch) return null;
    
    const digitsStr = khweMatch[1];
    const amount = parseInt(khweMatch[2], 10);
    
    let digits;
    if (digitsStr === '') {
      digits = ['0','1','2','3','4','5','6','7','8','9'];
    } else if (digitsStr.length < 3) {
      showNotification('At least 3 digits required for Khwe', 'warning');
      return null;
    } else {
      digits = digitsStr.split('');
    }
    
    return { digits, amount, type: 'khwe' };
  }
  
  // NEW FUNCTION: Process ·ÄÅ·ÄΩ pattern (XYX or YXY)
  function processKhwePattern(line) {
    // Pattern: ·ÄÅ·ÄΩ500 or ·ÄÅ·ÄΩ 500
    const khwePatternMatch = line.match(/^·ÄÅ·ÄΩ\s*(\d+)$/);
    if (!khwePatternMatch) return null;
    
    const amount = parseInt(khwePatternMatch[1], 10);
    const numbers = [];
    
    // Generate XYX pattern (X ‚â† Y)
    for (let x = 0; x <= 9; x++) {
      for (let y = 0; y <= 9; y++) {
        if (x !== y) {
          // XYX pattern
          const numXYX = x * 100 + y * 10 + x;
          numbers.push(numXYX);
          
          // YXY pattern (only if X ‚â† Y and we don't want duplicates)
          const numYXY = y * 100 + x * 10 + y;
          // Add YXY only if it's different from XYX
          if (numYXY !== numXYX) {
            numbers.push(numYXY);
          }
        }
      }
    }
    // Remove duplicates (in case any numbers appear twice)
    const uniqueNumbers = [...new Set(numbers)];
    
    return { type: 'khwe-pattern', numbers: uniqueNumbers, amount };
  }
  
  function processKhwePuKhweTri(line) {
    const khwePuKhweTriMatch = line.match(/^([0-9]+)·ÄÅ·ÄΩ·Ä±·Äï·Ä∞·Ä∏·ÄÅ·ÄΩtri(\d+)$/);
    if (!khwePuKhweTriMatch) return null;
    
    const digitsStr = khwePuKhweTriMatch[1];
    const amount = parseInt(khwePuKhweTriMatch[2], 10);
    
    const digits = [...new Set(digitsStr.split(''))];
    
    if (digits.length === 0) {
      showNotification('At least 1 digit required for Khwe Pu Khwe Tri', 'warning');
      return null;
    }
    
    return { digits, amount, type: 'khwe-pu-khwe-tri' };
  }
  
  function processApue(line) {
    const apueMatch = line.match(/^([0-9]*)·Ä°·Äï·Ä∞·Ä∏(\d+)$/);
    if (!apueMatch) return null;
    
    const digitsStr = apueMatch[1];
    const amount = parseInt(apueMatch[2], 10);
    
    let digits;
    if (digitsStr === '') {
      digits = ['0','1','2','3','4','5','6','7','8','9'];
    } else {
      digits = [...new Set(digitsStr.split(''))];
    }
    
    return { digits, amount, type: 'apue' };
  }
  
  function processTeit(line) {
    const teitMatch = line.match(/^([0-9]+)·Äë·Ä≠·Äï·Ä∫(\d+)$/);
    if (!teitMatch) return null;
    
    const digitsStr = teitMatch[1];
    const amount = parseInt(teitMatch[2], 10);
    
    const digits = [...new Set(digitsStr.split(''))];
    
    if (digits.length === 0) return null;
    
    return { digits, amount, type: 'teit' };
  }
  
  function processLel(line) {
    const lelMatch = line.match(/^([0-9]+)·Äú·Äö·Ä∫(\d+)$/);
    if (!lelMatch) return null;
    
    const digitsStr = lelMatch[1];
    const amount = parseInt(lelMatch[2], 10);
    
    const digits = [...new Set(digitsStr.split(''))];
    
    if (digits.length === 0) return null;
    
    return { digits, amount, type: 'lel' };
  }
  
  function processPeit(line) {
    const peitMatch = line.match(/^([0-9]+)·Äï·Ä≠·Äê·Ä∫(\d+)$/);
    if (!peitMatch) return null;
    
    const digitsStr = peitMatch[1];
    const amount = parseInt(peitMatch[2], 10);
    
    const digits = [...new Set(digitsStr.split(''))];
    
    if (digits.length === 0) return null;
    
    return { digits, amount, type: 'peit' };
  }
  
  function processDirectAndR(line) {
    line = line.trim();
    
    // = method for group betting (126 806 893=5000)
    const eqMethodMatch = line.match(/^([\d\s\/\*\.,-]+)=(\d+)$/);
    if (eqMethodMatch) {
      const numbersStr = eqMethodMatch[1];
      const amount = parseInt(eqMethodMatch[2], 10);
      const numbers = splitNumbers(numbersStr);
      
      if (numbers.length === 0) return null;
      
      return { type: 'eqMethod', numbers, amount };
    }
     // R method for group betting (126 806 893R5000)
    const rMethodMatch = line.match(/^([\d\s\/\*\.,-]+)r(\d+)$/i);
    if (rMethodMatch) {
      const numbersStr = rMethodMatch[1];
      const amount = parseInt(rMethodMatch[2], 10);
      const allNumbers = [];
      
      const baseNumbers = splitNumbers(numbersStr);
      
      if (baseNumbers.length === 0) return null;
      
      // For each number, generate permutations
      baseNumbers.forEach(num => {
        const numStr = pad3(num);
        const permutations = permute3(numStr);
        allNumbers.push(...permutations);
      });
      
      return { type: 'rMethod', numbers: allNumbers, amount };
    }
    
    return null;
  }
    // Initialize
  function init() {
    loadSavedData();
    updateLedger();
    switchTheme(currentTheme);
    
    // Update history display
    updateHistoryDisplay();
  }
  
  // Tab switching
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const tabName = tab.dataset.tab;
      
      // If 2D mode tab is clicked, immediately navigate to 2D page
      if (tabName === 'twod') {
        window.location.href = 'history.html';
        return;
      }
      
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      // Show/hide cards based on selected tab
      if (tabName === 'ledger') {
        ledgerCard.style.display = 'block';
        bulkCard.style.display = 'none';
        winningCard.style.display = 'none';
        historyCard.style.display = 'none';
        twodCard.style.display = 'none';
      } else if (tabName === 'add-bets') {
        ledgerCard.style.display = 'none';
        bulkCard.style.display = 'block';
        winningCard.style.display = 'none';
        historyCard.style.display = 'none';
        twodCard.style.display = 'none';
      } else if (tabName === 'winning') {
        ledgerCard.style.display = 'none';
        bulkCard.style.display = 'none';
        winningCard.style.display = 'block';
        historyCard.style.display = 'none';
        twodCard.style.display = 'none';
      } else if (tabName === 'history') {
        ledgerCard.style.display = 'none';
        bulkCard.style.display = 'none';
        winningCard.style.display = 'none';
        historyCard.style.display = 'block';
        twodCard.style.display = 'none';
        updateHistoryDisplay(); // Refresh history when tab is clicked
      }
      
      if (tabName !== 'winning') {
        winningResult.style.display = 'none';
      }
    });
  });
  
  // Submit bulk bets
  document.getElementById('btn-submit-bulk').addEventListener('click', () => {
    const text = document.getElementById('bulk-input').value.trim();
    if (!text) {
      showNotification('Please enter some bets', 'warning');
      return;
    }
    
    const lines = text.split('\n').map(l => l.trim()).filter(l => l);
    let addedCount = 0;
    let totalAdded = 0;
    let numbersAdded = 0;
    
    lines.forEach(line => {
      const rangeInfo = processRange(line);
      if (rangeInfo) {
        for (let num = rangeInfo.start; num <= rangeInfo.end; num++) {
          if (rangeInfo.method === 'r') {
            const perms = permute3(pad3(num));
            perms.forEach(permNum => {
              const existing = ledger.get(permNum) || 0;
              ledger.set(permNum, existing + rangeInfo.amount);
              totalAdded += rangeInfo.amount;
              numbersAdded++;
            });
          } else {
            const existing = ledger.get(num) || 0;
            ledger.set(num, existing + rangeInfo.amount);
            totalAdded += rangeInfo.amount;
            numbersAdded++;
          }
        }
        addedCount++;
        return;
      }
      
      // ====== ·ÄÅ·ÄΩ·Ä± Logic ======
      const khweInfo = processKhwe(line);
      if (khweInfo) {
        // Unique digits ·Äö·Ä∞·Äï·Ä´
        const uniqueDigits = [...new Set(khweInfo.digits)];
        const n = uniqueDigits.length;
        
        if (n < 3) {
          showNotification('At least 3 different digits required for Khwe', 'warning');
          return;
        }
        
        // nP3 = n * (n-1) * (n-2) permutations
        for (let i = 0; i < n; i++) {
          for (let j = 0; j < n; j++) {
            if (j === i) continue;
            for (let k = 0; k < n; k++) {
              if (k === i || k === j) continue;
              // ·ÄÇ·Äè·Äî·Ä∫·Ä∏·Äû·ÄØ·Ä∂·Ä∏·Äú·ÄØ·Ä∂·Ä∏·Äñ·ÄΩ·Ä≤·Ä∑·Äï·Ä´
              const numStr = uniqueDigits[i] + uniqueDigits[j] + uniqueDigits[k];
              const num = parseInt(numStr, 10);
              const existing = ledger.get(num) || 0;
              ledger.set(num, existing + khweInfo.amount);
              totalAdded += khweInfo.amount;
              numbersAdded++;
            }
          }
        }
        addedCount++;
        return;
      }
      
      // ====== NEW: ·ÄÅ·ÄΩ Pattern (XYX or YXY) ======
      const khwePatternInfo = processKhwePattern(line);
      if (khwePatternInfo) {
        khwePatternInfo.numbers.forEach(num => {
          const existing = ledger.get(num) || 0;
          ledger.set(num, existing + khwePatternInfo.amount);
          totalAdded += khwePatternInfo.amount;
          numbersAdded++;
        });
        addedCount++;
        return;
      }
      
      const khwePuKhweTriInfo = processKhwePuKhweTri(line);
      if (khwePuKhweTriInfo) {
        khwePuKhweTriInfo.digits.forEach(d1 => {
          khwePuKhweTriInfo.digits.forEach(d2 => {
            khwePuKhweTriInfo.digits.forEach(d3 => {
              const num = parseInt(`${d1}${d2}${d3}`, 10);
              const existing = ledger.get(num) || 0;
              ledger.set(num, existing + khwePuKhweTriInfo.amount);
              totalAdded += khwePuKhweTriInfo.amount;
              numbersAdded++;
            });
          });
        });
        addedCount++;
        return;
      }
      
      const apueInfo = processApue(line);
      if (apueInfo) {
        for (let x = 0; x <= 9; x++) {
          for (let y = 0; y <= 9; y++) {
            if (x !== y) {
              const num1 = parseInt(`${x}${x}${y}`, 10);
              const num2 = parseInt(`${x}${y}${y}`, 10);
              if (apueInfo.digits.includes(x.toString()) || apueInfo.digits.includes(y.toString())) {
                const existing1 = ledger.get(num1) || 0;
                const existing2 = ledger.get(num2) || 0;
                ledger.set(num1, existing1 + apueInfo.amount);
                ledger.set(num2, existing2 + apueInfo.amount);
                totalAdded += apueInfo.amount * 2;
                numbersAdded += 2;
              }
            }
          }
        }
        addedCount++;
        return;
      }
      
      const teitInfo = processTeit(line);
      if (teitInfo) {
        teitInfo.digits.forEach(digit => {
          for (let j = 0; j <= 9; j++) {
            for (let k = 0; k <= 9; k++) {
              const num = parseInt(`${digit}${j}${k}`, 10);
              const existing = ledger.get(num) || 0;
              ledger.set(num, existing + teitInfo.amount);
              totalAdded += teitInfo.amount;
              numbersAdded++;
            }
          }
        });
        addedCount++;
        return;
      }
      
      const lelInfo = processLel(line);
      if (lelInfo) {
        lelInfo.digits.forEach(digit => {
          for (let i = 0; i <= 9; i++) {
            for (let k = 0; k <= 9; k++) {
              const num = parseInt(`${i}${digit}${k}`, 10);
              const existing = ledger.get(num) || 0;
              ledger.set(num, existing + lelInfo.amount);
              totalAdded += lelInfo.amount;
              numbersAdded++;
            }
          }
        });
        addedCount++;
        return;
      }
      
      const peitInfo = processPeit(line);
      if (peitInfo) {
        peitInfo.digits.forEach(digit => {
          for (let i = 0; i <= 9; i++) {
            for (let j = 0; j <= 9; j++) {
              const num = parseInt(`${i}${j}${digit}`, 10);
              const existing = ledger.get(num) || 0;
              ledger.set(num, existing + peitInfo.amount);
              totalAdded += peitInfo.amount;
              numbersAdded++;
            }
          }
        });
        addedCount++;
        return;
      }
      
      const directAndRInfo = processDirectAndR(line);
      if (directAndRInfo) {
        directAndRInfo.numbers.forEach(num => {
          const existing = ledger.get(num) || 0;
          ledger.set(num, existing + directAndRInfo.amount);
          totalAdded += directAndRInfo.amount;
          numbersAdded++;
        });
        addedCount++;
        return;
      }
      // If no special format, treat as individual numbers with amount at end
      const parts = line.split(/\s+/);
      if (parts.length >= 2) {
        const amount = parseInt(parts[parts.length - 1]);
        if (!isNaN(amount)) {
          const numberParts = parts.slice(0, parts.length - 1);
          const numbers = splitNumbers(numberParts.join(' '));
          if (numbers.length > 0) {
            numbers.forEach(n => {
              const existing = ledger.get(n) || 0;
              ledger.set(n, existing + amount);
              totalAdded += amount;
              numbersAdded++;
            });
            addedCount++;
            return;
          }
        }
      }
      
      // Last resort: split numbers and use default amount
      const nums = splitNumbers(line);
      if (nums.length > 0) {
        const amount = currentAmount;
        nums.forEach(n => {
          const existing = ledger.get(n) || 0;
          ledger.set(n, existing + amount);
          totalAdded += amount;
          numbersAdded++;
        });
        addedCount++;
      }
    });
    
    updateLedger();
    
    // Add to history
    if (numbersAdded > 0) {
      addHistoryEntry('bulk_added', {
        lineCount: addedCount,
        numbersCount: numbersAdded,
        total: totalAdded
      });
    }
    
    showNotification(`Added ${addedCount} line(s) | Total: ${totalAdded.toLocaleString()}`);
    
    document.getElementById('bulk-input').value = '';
    
    // Switch to ledger tab
    tabs.forEach(t => t.classList.remove('active'));
    tabs[0].classList.add('active');
    ledgerCard.style.display = 'block';
    bulkCard.style.display = 'none';
    winningCard.style.display = 'none';
    historyCard.style.display = 'none';
    twodCard.style.display = 'none';
  });
  
  // Clear input
  document.getElementById('btn-clear-input').addEventListener('click', () => {
    if (confirm('Clear input textarea?')) {
      document.getElementById('bulk-input').value = '';
    }
  });
  
  // Preview button
  document.getElementById('btn-preview').addEventListener('click', () => {
    const text = document.getElementById('bulk-input').value.trim();
    if (!text) {
      showNotification('Please enter some bets to preview', 'warning');
      return;
    }
    
    const lines = text.split('\n').map(l => l.trim()).filter(l => l);
    let previewText = 'Preview of bets:\n\n';
    
    lines.forEach((line, index) => {
      previewText += `${index + 1}. ${line}\n`;
    });
    
    previewText += `\nTotal lines: ${lines.length}`;
    
    alert(previewText);
  });
  
  // Show remaining numbers
  document.getElementById('btn-show-remaining').addEventListener('click', () => {
    if (!isRemainingShown) {
      showRemainingNumbers();
    } else {
      remainingBox.textContent = '(Click "Show" to view numbers not in ledger)';
      isRemainingShown = false;
      document.getElementById('btn-show-remaining').innerHTML = '<i class="fas fa-eye"></i> Show';
    }
  });
    // Copy remaining numbers
  document.getElementById('btn-copy-remaining').addEventListener('click', async () => {
    const text = remainingBox.textContent.trim();
    if (!text || text.includes('Click "Show"')) {
      showNotification('No remaining numbers to copy', 'warning');
      return;
    }
    await navigator.clipboard.writeText(text);
    showNotification('Remaining numbers copied to clipboard');
  });
  
  // Add all remaining numbers
  document.getElementById('btn-add-remaining').addEventListener('click', () => {
    const rem = computeRemaining();
    const amount = currentAmount;
    
    if (rem.length === 0) {
      showNotification('No remaining numbers to add', 'warning');
      return;
    }
    
    if (confirm(`Add all ${rem.length} remaining numbers with amount ${amount} each?\nTotal: ${(rem.length * amount).toLocaleString()}`)) {
      rem.forEach(numStr => {
        const num = parseInt(numStr, 10);
        const existing = ledger.get(num) || 0;
        ledger.set(num, existing + amount);
      });
      updateLedger();
      
      // Add to history
      addHistoryEntry('remaining_added', {
        count: rem.length,
        total: rem.length * amount
      });
      
      showNotification(`Added ${rem.length} numbers to ledger`);
    }
  });
  
  // Copy ledger
  document.getElementById('btn-copy').addEventListener('click', async () => {
    if (ledger.size === 0) {
      showNotification('Ledger is empty', 'warning');
      return;
    }
    const lines = [...ledger].map(([n,a]) => `${pad3(n)} ${a}`).join('\n');
    await navigator.clipboard.writeText(lines);
    showNotification('Ledger copied to clipboard');
  });
  
  // Clear ledger
  document.getElementById('btn-clear').addEventListener('click', () => {
    if (!confirm('Clear all ledger entries? This cannot be undone.')) return;
    
    addHistoryEntry('ledger_cleared', {});
    ledger.clear();
    updateLedger();
    showNotification('Ledger cleared', 'warning');
  });
  
  // Clear winning input
  document.getElementById('btn-clear-winning').addEventListener('click', () => {
    winningInput.value = '';
    winningMultiplierSelect.value = '800';
    winningResult.style.display = 'none';
  });
  
  // Check winning numbers
  document.getElementById('btn-check-winning').addEventListener('click', () => {
    const numbersText = winningInput.value.trim();
    if (!numbersText) {
      showNotification('Please enter winning numbers', 'warning');
      return;
    }
    
    // Split by space or comma and filter valid numbers
    const numbers = numbersText.split(/[,\s]+/)
      .map(n => n.trim())
      .filter(n => /^\d{1,3}$/.test(n))
      .map(n => {
        // Convert to 3-digit number
        const num = parseInt(n, 10);
        return num < 10 ? num * 100 : (num < 100 ? num * 10 : num);
      })
      .filter(n => n >= 0 && n <= 999);
    
    if (numbers.length === 0) {
      showNotification('No valid numbers found (000-999 only)', 'warning');
      return;
    }
    
    const multiplier = parseInt(winningMultiplierSelect.value);
    
    let totalWin = 0;
    let breakdown = [];
    let hasWinner = false;
    let winnerCount = 0;
    
    numbers.forEach(num => {
      const ledgerAmount = ledger.get(num) || 0;
      if (ledgerAmount > 0) {
        const winForThisNumber = ledgerAmount * multiplier;
        totalWin += winForThisNumber;
        breakdown.push(`
          <div class="winning-item">
            <span>${pad3(num)}</span>
            <span>${ledgerAmount} √ó ${multiplier} = <span class="win-amount">${winForThisNumber.toLocaleString()}</span></span>
          </div>
        `);
        hasWinner = true;
        winnerCount++;
      } else {
        breakdown.push(`
          <div class="winning-item no-winner">
            <span>${pad3(num)}</span>
            <span>No bet (0)</span>
          </div>
        `);
      }
    });
    
    totalWinAmount.textContent = totalWin.toLocaleString();
    winningBreakdown.innerHTML = breakdown.join('');
    
    if (hasWinner) {
      congratsMessage.innerHTML = `üéâ Congratulations! ${winnerCount} winning number(s) üéâ`;
      winningResult.style.display = 'block';
      
      // Add to history
      if(winnerCount > 0) {
        addHistoryEntry('winning_checked', {
          winnerCount: winnerCount,
          totalWin: totalWin,
          multiplier: multiplier,
          numbers: numbers.map(n => pad3(n))
        });
      }
    } else {
      congratsMessage.innerHTML = `<span style="color: var(--danger-color);">No winning numbers found in ledger</span>`;
      winningResult.style.display = 'block';
    }
    
    // Scroll to result
    winningResult.scrollIntoView({ behavior: 'smooth' });
  });
  
  // Clear history
  document.getElementById('btn-clear-history').addEventListener('click', () => {
    if (!confirm('Clear all history? This cannot be undone.')) return;
    
    history = [];
    localStorage.removeItem('ledgerHistory');
    updateHistoryDisplay();
    
    showNotification('History cleared', 'warning');
  });
  
  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Ctrl+S to save
    if (e.ctrlKey && e.key === 's') {
      e.preventDefault();
      saveLedger();
      showNotification('Ledger saved');
    }
    
    // Ctrl+C to copy ledger
    if (e.ctrlKey && e.key === 'c') {
      if (ledger.size > 0) {
        e.preventDefault();
        document.getElementById('btn-copy').click();
      }
    }
    
    // Ctrl+L to clear ledger
    if (e.ctrlKey && e.key === 'l') {
      e.preventDefault();
      document.getElementById('btn-clear').click();
    }
    
    // Ctrl+1-5 to switch tabs
    if (e.ctrlKey && e.key >= '1' && e.key <= '5') {
      e.preventDefault();
      const tabIndex = parseInt(e.key) - 1;
      if (tabs[tabIndex]) {
        tabs[tabIndex].click();
      }
    }
    
    // Esc to close notifications
    if (e.key === 'Escape') {
      const notifications = document.querySelectorAll('.notification');
      notifications.forEach(notification => notification.remove());
    }
  });
  
  // Initialize the application
  init();
})();
</script>
</body>
</html>